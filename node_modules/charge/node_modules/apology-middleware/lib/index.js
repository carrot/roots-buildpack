// Generated by CoffeeScript 1.7.1
(function() {
  var fs, path;

  fs = require('fs');

  path = require('path');


  /**
   * Configures options and returns a middleware function.
   *
   * @param  {String} file - path to custom error page. Default 'lib/404.html'
   * @return {Function} middleware function
   */

  module.exports = function(root, file) {
    var error_page, fallback;
    fallback = path.join(__dirname, '404.html');
    error_page = fallback;
    if (!file && root) {
      error_page = path.resolve(root);
    }
    if (file && root) {
      error_page = path.join(root, file);
    }
    return function(err, req, res, next) {
      res.statusCode = 404;
      res.setHeader('Content-Type', 'text/html');
      if (!fs.lstatSync(error_page).isDirectory()) {
        res.write(fs.readFileSync(error_page));
      } else {
        res.write(fs.readFileSync(fallback));
      }
      return res.end();
    };
  };

}).call(this);
