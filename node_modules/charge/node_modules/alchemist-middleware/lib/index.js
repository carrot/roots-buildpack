// Generated by CoffeeScript 1.7.0
(function() {
  var dir, parseurl, path, send, url;

  send = require('send');

  path = require('path');

  parseurl = require('parseurl');

  url = require('url');

  module.exports = function(root, opts) {
    if (opts == null) {
      opts = {};
    }
    if (!root) {
      throw new TypeError('root path required');
    }
    opts.root = path.resolve(root);
    return function(req, res, next) {
      var _path, _url;
      if (req.method !== 'GET' && req.method !== 'HEAD') {
        return next();
      }
      _url = url.parse(req.originalUrl || req.url);
      _path = parseurl(req).pathname;
      return send(req, _path, opts).on('error', next).on('directory', dir.bind(null, _url, res)).pipe(res);
    };
  };

  dir = function(_url, res) {
    var target;
    _url.pathname += '/';
    target = url.format(_url);
    res.statusCode = 303;
    res.setHeader('Location', target);
    return res.end("Redirecting to " + target);
  };

}).call(this);
